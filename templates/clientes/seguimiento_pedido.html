<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Seguimiento de Pedidos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/seguimiento_del_pedido.css') }}">
</head>
<body>

<a href="javascript:history.back()" class="btn btn-primary volver-btn" 
   style="position: absolute; top: 15px; left: 20px; border-radius: 10px; padding: 12px 25px;">
   â† Volver
</a>

<div class="falling-products">
    <span>ğŸ§</span>
    <span>ğŸª</span>
    <span>ğŸ‚</span>
    <span>ğŸ©</span>
    <span>ğŸ°</span>
    <span>ğŸ§</span>
    <span>ğŸª</span>
    <span>ğŸ‚</span>
</div>

<header>
    <h2>ğŸ“¦ SEGUIMIENTO DE TUS PEDIDOS</h2>
</header>

<main class="container">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert {{ category }}">
                    {{ message }}
                    <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div id="pedidos-container">
        {% if pedidos %}
        <table class="tabla-pedidos">
            <thead>
                <tr>
                    <th>ID Pedido</th>
                    <th>Cliente</th>
                    <th>Fecha Solicitud</th>
                    <th>Fecha Entrega</th>
                    <th>Total</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                <tr>
                    <td>{{ pedido.ID_Pedido }}</td>
                    <td>{{ pedido.Cliente }}</td>
                    <td>{{ pedido.Fecha_Solicitud }}</td>
                    <td>{{ pedido.Fecha_Entrega }}</td>
                    <td>${{ pedido.Total }}</td>
                    <td>{{ pedido.Estado_Pedido }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="sin-pedido">No se encontrÃ³ ningÃºn pedido.</p>
        {% endif %}
    </div>

</main>

{% block footer %}
  {% include './footer.html' %}
{% endblock %}

<!-- ğŸ”„ ACTUALIZACIÃ“N EN TIEMPO REAL -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Actualiza la tabla cada 5 segundos (puedes ajustar el tiempo)
    setInterval(async () => {
        try {
            const response = await fetch('{{ url_for("clientes.seguimiento_pedido") }}', {
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            });
            const html = await response.text();

            // Extrae solo el contenido del div con los pedidos
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const nuevosPedidos = doc.querySelector('#pedidos-container');

            // Reemplaza el contenido actual con el nuevo
            if (nuevosPedidos) {
                document.querySelector('#pedidos-container').innerHTML = nuevosPedidos.innerHTML;
            }
        } catch (error) {
            console.error("Error actualizando pedidos:", error);
        }
    }, 5000);
});
</script>
<footer class="footer">
    <div class="footer-contenido">
      <div class="footer-item">
        <h4>â° Horarios de atenciÃ³n</h4>
        <p>Lunes a Viernes: 7am - 8pm</p>
        <p>SÃ¡bados, Domingos y Festivos: 9am - 5:30pm</p>
      </div>
      <div class="footer-item">
        <h4>ğŸ‘©â€ğŸ’» ContÃ¡ctanos</h4>
        <p>ComunÃ­cate con nosotros</p>
      </div>

      <div class="footer-item">
        <h4>â“ Preguntas</h4>
        <p>Â¿Tienes dudas?</p>
      </div>
      <div class="footer-item">
        <h4>ğŸ“ UbicaciÃ³n</h4>
        <p>Carrera #56 #19c -</p>
      </div>
    </div>
  </footer>
</body>
</html>
